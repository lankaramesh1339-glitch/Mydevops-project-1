pipeline {
    agent any
    stages {
        stage('Checkout') { 
            steps { 
                git branch: "master",url: "https://github.com/lankaramesh1339-glitch/Mydevops-project-1.git" 
            } 
        }
        stage('Install Dependencies') { 
            steps { 
                sh 'npm install' 
           } 
        }
        stage('Unit Tests') { 
            steps { 
                sh 'npm test' 
          } 
       }
        stage('SonarQube Scan') { 
            steps { 
                withSonarQubeEnv('SonarQube');{
                 sh 'sonar-scanner -Dsonar.projectKey=auth-service' } 
            } 
        }
        stage('Docker Build') { 
            steps { 
                sh 'docker build -t auth-service:latest ./auth-service' 
            } 
        }
        stage('Trivy Scan') { 
            steps {
                 sh 'trivy image auth-service:latest' 
            } 
       }
        stage('Push Image') { 
            steps { 
                sh 'docker push auth-service:latest'
             } 
        }
    }
}
